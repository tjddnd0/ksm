<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="mobile-web-app-capable" content="yes">
        <meta http-equiv="Expires" content="-1">
        <link rel="manifest" href="./manifest.json">
        <link rel="stylesheet" href="./css/index.css?2024">
        <link rel="icon" href="./img/ksmicon.png">
        <link rel="apple-touch-icon" href="/img/logo.favicon.png">
        <title>KSM</title>
        <style>
        .splash {
            z-index: 10;
            position: fixed;
            width: 100vw;
            height: 100vh;
            position: fixed;
            background-color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 0.7s;
        }

        .splash-img {
            width: 500px;
            animation: fadein 0.7s;
            animation-play-state: running;
            animation-fill-mode: forwards;
        }

        @media (prefers-color-scheme: dark) {
            * {
                margin: 0px;
                padding: 0px;
            }

            body {
                background-color: #202124;
                color: white;
            }

            .splash {
                background-color: #202124;
            }
        }

        .BUT {
            width: 50px;
            height: 50px;
        }
        </style>
    </head>
    <body onload="load();">
        <div class="splash">
            <img
                src="./img/ksmicon.png"
                id="splash-img"
                height="20%"
            >
        </div>
        <div class="modal_background" onclick="modalClose()"></div>
        <div class="content" style="display: none;">
        <div class="story-sub">
            <div class="font40px">스토리</div>
            <div class="asm">
                <img src="./img/ksmicon.png" style="height: 50px;" onclick="reload()">
            </div>
        </div>
        <div class="story_main">
            <div class="right_list_item" onClick="location.href='./page/storyedit.html'" style="background-image: url('./img/edit.png');"></div>
            <div class="right_list"></div>
        </div>
        <div class="widget_content">
            <div class="main_widget">
                a
            </div>
            <div class="sub_widget">
                b
            </div>
        </div>
        <div class="expandUp modal_wrap">
            <div class="modal_close" onclick="modalClose()">
                <img src="./img/close.svg" width="100%">
            </div>
            <div style="background-color: red;width: 100%;height: 100%;border: 1px solid black;">
                <h1 class="modal_title">안녕하세요</h1>
                <h3 class="modal_content">반갑습니다</h3>
            </div>
        </iframe>
    </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
    <script src="./js/index.js"></script>
    <script src="./js/meal.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAg-7fux86ZF0KfIkzCchO-sDyZ9_BJef8",
            authDomain: "kisuksasm.firebaseapp.com",
            projectId: "kisuksasm",
            storageBucket: "kisuksasm.appspot.com",
            messagingSenderId: "533806376102",
            appId: "1:533806376102:web:55ff491ecaeea82d9dc067",
            measurementId: "G-0V1M5LCDER"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const storageRef = storage.ref();
        const splash = document.querySelector(".splash");
        const content = document.querySelector(".content");

        window.addEventListener('load', function () {
            var timer = setTimeout(function () {
                splash.style.opacity = '0';
                content.style.display = 'block';

                // 스플래시 화면을 숨기기 위해 페이드 아웃이 완료되면 display: none으로 변경
                setTimeout(function () {
                    splash.style.display = 'none';
                }, 700); // 0.8초 후에 스플래시 화면 숨김
                clearTimeout(timer);
            }, 500); // 2초 후에 스플래시 화면 페이드 아웃 시작
        });

        window.addEventListener('popstate', function (event) {
            modalClose();
        });

        class 클래스 extends HTMLElement {
            connectedCallback() {
                const itemdata = this.getAttribute('data');
                const items = JSON.parse(itemdata);
                this.innerHTML = '<div class="function_item" onclick="location.href=\'' + items[0] + '\'">\
                    <div class="function_item_img">\
                    <img src="./img/function/'+ items[1] + '" width="100%"\
                    style="border-radius: 15px;"></div>\
                    <div class="function_item_title">\
                    <div class="function_item_main">'+ items[2] + '</div>\
                    <div class="function_item_sub">'+ items[3] + '</div>\
                    </div></div>';
            }
        }

        customElements.define('function-widget', 클래스);

        function readData() {
            // 데이터 가져오기
            db.collection("storys")
            .get()
            .then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                var 템플릿 = `<div id="${doc.id}" class="right_list_item" onClick="javascript:story('${doc.id}')" style="background-image: url('${doc.data().사진}');">
                            <div class="right_list_item_title">${doc.data().제목}</div></div>`;
                            document.querySelector(".right_list").innerHTML += 템플릿;
                console.log(doc.id, " => ", doc.data());
                });
            })
            .catch((error) => {
                console.error("Error getting documents: ", error);
            });
        }
        readData();

        function story(docId) {
            db.collection("storys")
            .doc(String(docId))
            .get()
            .then((doc) => {
                document.querySelector(".modal_title").innerHTML = doc.data().제목;
                document.querySelector(".modal_content").innerHTML = doc.data().내용;

                console.log("선택 스토리 제목 => ",doc.data().제목);
            });
            modalOpen();
        }

        const modal_wrap = document.querySelector(".modal_wrap");
        const modal_background = document.querySelector(".modal_background");
        const html = document.querySelector("html");
        const story_iframe = document.querySelector(".story-iframe");

        // 모달 열기
        function modalOpen() {
            window.history.pushState(null, null, window.location.href);
            modal_wrap.style.display = 'block';
            modal_background.style.display = 'block';
            html.style.overflowY = 'hidden';
        }

        // 모달 끄기
        function modalClose() {
            modal_wrap.style.display = 'none';
            modal_background.style.display = 'none';
            html.style.overflowY = 'auto';
            story_iframe.src = 'about:blank';
        }

        function handleIFrameURLChange() {
            var currentURL = story_iframe.contentWindow.location.href;

            if (currentURL === "about:blank") {
                modalClose();
            }
        }

        function fromAppToWeb(msg) {
            document.querySelector('.flutterMessageTitle').innerHTML = msg;
        }

        function fromWebToApp(msg) {
            var now = new Date();	// 현재 날짜 및 시간
            //toApp.postMessage('' + now);
            toApp.postMessage(msg);
        }

        b1 = document.querySelector('.asm_function_sub_b1');
        b2 = document.querySelector('.asm_function_sub_b2');
        b3 = document.querySelector('.asm_function_sub_b3');
        asmsvg = document.querySelector('.asmsvg');
        asmdiv = document.querySelector('.asm_function_main_div');

        asmurl = 1;

        function asmfuction(b) {
            //alert(b);
            if (b == 'asm_function_sub_b1') {
                asmsvg.style.filter = 'invert(26%) sepia(95%) saturate(4736%) hue-rotate(346deg) brightness(99%) contrast(88%)';
                asmdiv.style.backgroundColor = '#ef2e32';
                b1.style.backgroundColor = '#303134';
                b2.style.backgroundColor = 'transparent';
                b3.style.backgroundColor = 'transparent';
                asmurl = 1;
            } else if (b == 'asm_function_sub_b2') {
                asmsvg.style.filter = 'invert(71%) sepia(7%) saturate(3394%) hue-rotate(88deg) brightness(87%) contrast(83%)';
                asmdiv.style.backgroundColor = '#40bb6a';
                b1.style.backgroundColor = 'transparent';
                b2.style.backgroundColor = '#303134';
                b3.style.backgroundColor = 'transparent';
                asmurl = 2;
            } else if (b == 'asm_function_sub_b3') {
                asmsvg.style.filter = 'invert(41%) sepia(81%) saturate(466%) hue-rotate(174deg) brightness(86%) contrast(91%)';
                asmdiv.style.backgroundColor = '#3871c1';
                b1.style.backgroundColor = 'transparent';
                b2.style.backgroundColor = 'transparent';
                b3.style.backgroundColor = '#303134';
                asmurl = 3;
            }
        }

        function asmfuctionurl() {
            if (asmurl == 1) {
                location.href='https://www.youtube.com/@user-qp4hz9hs9p';
            }else if (asmurl == 2) {
                location.href='http://smart.cnehs.kr/main.do';
            }else if (asmurl == 3) {
                location.href='https://asm.meistergo.co.kr/';
            }
        }
        b1.style.backgroundColor = '#303134';
        asmsvg.style.filter = 'invert(26%) sepia(95%) saturate(4736%) hue-rotate(346deg) brightness(99%) contrast(88%)';
        asmdiv.style.backgroundColor = '#ef2e32';
    </script>
</body>
</html>
